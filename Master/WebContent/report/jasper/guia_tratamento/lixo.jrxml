<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="guia_tratamento" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<parameter name="CONTEXT_PATH" class="java.lang.String">
		<defaultValueExpression><![CDATA["C:\\Documents and Settings\\marcdfranc\\Meus documentos\\sistemas\\master\\master.com\\WebContent\\report\\image_report\\"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT l.codigo AS guia, l.recebimento, p.cod_orcamento, f.nome AS profissional, r.conselho,
	i.descricao AS fone, l.valor, j.fantasia, a.referencia AS ref_unidade,
	u.descricao AS unidade,
	(SELECT DISTINCT k.nome FROM fisica AS k
		INNER JOIN pessoa AS g ON(k.codigo = g.codigo)
	WHERE g.username = l.recebimento) AS login_name, k.descricao AS atendimento,
	CASE
		WHEN o.cod_dependente ISNULL THEN s.nome
		ELSE d.nome
	END AS cliente, o.parcelas AS parcelamento,
	(SELECT COUNT(*) FROM parcela_orcamento AS c 
		INNER JOIN lancamento AS m ON(c.cod_lancamento = m.codigo)
		WHERE c.cod_orcamento = o.codigo
			AND m.status IN('q', 'f')) AS pagas,
	CASE
		WHEN o.cod_dependente ISNULL THEN e.referencia || '-0'
		ELSE e.referencia || '-' || d.referencia
	END AS ctr, n.rua_av AS rua, n.numero, n.bairro AS bairro
FROM lancamento AS l
	INNER JOIN parcela_orcamento  AS p ON(p.cod_lancamento = l.codigo)
	INNER JOIN orcamento AS o ON(p.cod_orcamento = o.codigo)
	INNER JOIN profissional AS r ON(o.cod_pessoa = r.codigo)
	INNER JOIN fisica AS f ON(r.codigo = f.codigo)
	INNER JOIN endereco AS n ON(r.codigo = n.cod_pessoa)
	LEFT JOIN informacao AS i ON(i.cod_pessoa = r.codigo)
	INNER JOIN fisica AS s ON(o.cod_usuario = s.codigo)
	LEFT JOIN dependente AS d ON(o.cod_dependente = d.codigo)
	INNER JOIN pessoa AS e ON(s.codigo = e.codigo)
	INNER JOIN juridica AS j ON(l.cod_unidade = j.codigo)
	INNER JOIN unidade AS u ON(l.cod_unidade = u.codigo)
	INNER JOIN pessoa AS a ON(j.codigo = a.codigo)
	right JOIN informacao AS k ON(j.codigo = k.cod_pessoa)
WHERE i.principal = 's'
	AND k.principal = 's'
	AND l.codigo = 31299]]>
	</queryString>
	<field name="guia" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="recebimento" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="cod_orcamento" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="profissional" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="conselho" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="fone" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="valor" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="fantasia" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="ref_unidade" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="unidade" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="login_name" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="atendimento" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="cliente" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="parcelamento" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="pagas" class="java.lang.Long">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="ctr" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="rua" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="numero" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="bairro" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="47" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="61" splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="125" splitType="Stretch">
			<textField>
				<reportElement x="44" y="17" width="100" height="20"/>
				<textElement/>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{guia}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="45" splitType="Stretch"/>
	</columnFooter>
</jasperReport>
